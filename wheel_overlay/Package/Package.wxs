<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package Name="Wheel Overlay" 
           Manufacturer="OBRL" 
           Version="0.2.0.0" 
           UpgradeCode="19d19028-090f-4888-912b-650058e100f7"
           Compressed="yes"
           InstallerVersion="200"
           Scope="perMachine">
    
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    
    <MediaTemplate EmbedCab="yes" />

    <!-- Properties -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <Property Id="ARPPRODUCTICON" Value="AppIcon" />
    <Property Id="ARPNOMODIFY" Value="1" />
    <Property Id="ARPNOREPAIR" Value="1" />
    
    <!-- Shortcut selection properties -->
    <Property Id="INSTALLSTARTMENUSHORTCUT" Value="1" />
    <Property Id="INSTALLDESKTOPSHORTCUT" Value="1" />

    <!-- UI Configuration - Custom UI -->
    <UIRef Id="CustomInstallDir" />

    <Icon Id="AppIcon" SourceFile="app.ico"/>

    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="WheelOverlay" />
    </StandardDirectory>

    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="Wheel Overlay" />
    </StandardDirectory>
    
    <StandardDirectory Id="DesktopFolder" />

    <Feature Id="Main" Title="Wheel Overlay" Level="1">
      <ComponentGroupRef Id="AppComponents" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="DesktopShortcut" />
    </Feature>
  </Package>

  <!-- Application Files - Generated dynamically by build script -->
  <Fragment>
    <ComponentGroup Id="AppComponents" Directory="INSTALLFOLDER">
      <!-- APPLICATION_FILES_START -->
      <Component>
        <File Source="WheelOverlay.exe" KeyPath="yes" />
      </Component>
      <!-- APPLICATION_FILES_END -->
    </ComponentGroup>
  </Fragment>

  <!-- Start Menu Shortcut -->
  <Fragment>
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="e8369302-3932-491c-8f43-855f93976375" Condition="INSTALLSTARTMENUSHORTCUT=&quot;1&quot;">
        <Shortcut Id="ApplicationStartMenuShortcut" 
                  Name="Wheel Overlay" 
                  Description="Wheel Overlay Tool"
                  Target="[INSTALLFOLDER]WheelOverlay.exe"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="AppIcon"/>
        <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\OBRL\WheelOverlay" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>
  </Fragment>
  
  <!-- Desktop Shortcut -->
  <Fragment>
    <Component Id="DesktopShortcut" Directory="DesktopFolder" Guid="f8369302-3932-491c-8f43-855f93976376" Condition="INSTALLDESKTOPSHORTCUT=&quot;1&quot;">
      <Shortcut Id="ApplicationDesktopShortcut"
                Name="Wheel Overlay"
                Description="Wheel Overlay Tool"
                Target="[INSTALLFOLDER]WheelOverlay.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="AppIcon"/>
      <RegistryValue Root="HKCU" Key="Software\OBRL\WheelOverlay" Name="DesktopShortcut" Type="integer" Value="1" KeyPath="yes"/>
    </Component>
  </Fragment>
</Wix>
